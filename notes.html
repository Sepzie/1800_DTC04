<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>My BCIT Project</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <!-- Bootstrap FirebaseUI CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
    <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/4.8.1/firebase-ui-auth.css" />


    <!-- Google Icons (Material Design)-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">


    <!-- Firebase 8 CDNs-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous">
    </script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/ui/4.8.1/firebase-ui-auth.js"></script>

    <script src="scripts/firebaseAPI.js"></script>

    <!-- Link to the api keys for your firebase project -->
    <link href="./styles/my_style.css" rel="stylesheet">

    <!-- CDN-->
    <script src="https://www.gstatic.com/firebasejs/ui/4.8.1/firebase-ui-auth.js"></script>
    <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/4.8.1/firebase-ui-auth.css" />
    <link href="./styles/colour_styles.css" rel="stylesheet">

    <style>
        section {
            margin-top: 5%;
        }

        a {
            margin-bottom: 2%;
        }

        #topnav {
            font-size: larger;
        }

        #navbar {
            margin: auto;
        }
    </style>
</head>

<body id="body">
    <nav class="navbar navbar-expand-lg navbar-light bg-primary" id="navbar">
        <div class="container-fluid">
            <a class="navbar-brand" href="./main.html">VLB</a>
            <a href="/profile.html"><img class="bi-window text-primary" id="profile" src="./images/account.png"
                    alt="..."></a>

        </div>
    </nav>


    <ul class="nav nav-pills nav-fill" id="topnav">
        <li class="nav-item">
            <a class="nav-link" aria-current="page" href="/classroom.html">Classroom</a>
        </li>
        <li class="nav-item">
            <a class="nav-link active" href="notes.html">Notes</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#">Clips</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="todo.html">To-Do</a>
        </li>
    </ul>


    <template id="DateTemplate" class="container">
        <div class="row">
            <p class="date-goes-here col list-group-item list-group-item-action active">
                25 November, 2021
            </p>
        </div>
        <div class="row class-goes-here">

        </div>
    </template>

    <template id="ClassTemplate" class="row">
        <div class="col-sm" style="margin-bottom: 5%; margin-top: 2%;">
            <div class="card" style="width: 18rem;">
                <div class="card-body">
                    <h5 class="card-title">COMP 1537</h5>
                    <p class="card-text instructor">Instructor: Arron Ferguson</p>
                    <p class="card-text time">Time: 8:30-10:20</p>
                    <a href="./viewnotes.html" class="btn btn-primary viewMore" style="float: right; width: 30%; font-size: 0.6em;" onclick="setLocalStorage(this.id)">View More</a>
                </div>
            </div>
        </div>
    </template>
    <script>
        function insertName() {
            firebase.auth().onAuthStateChanged(user => {
                if (user) {
                    console.log(user.uid);
                    currentUser = db.collection("users").doc(user.uid);
                    currentUser.get().then(userDoc => {
                        var user_Name = userDoc.data().name;
                        console.log(user_Name);
                        console.log(userDoc.data().set)
                        displaySchedule(userDoc.data().set);
                        $("#name-goes-here").text(user_Name);
                    })
                } else {
                }
            });
        }
        function displaySchedule(setName) {
            let DateTemplate = document.getElementById("DateTemplate")
            let ClassTemplate = document.getElementById("ClassTemplate")

            var set = db.collection("classes").doc(setName)
            set.get()
                .then(setDoc => {
                    var Dates = setDoc.data().Dates;
                    for (i = 0; i < Dates.length; i++) { 
                        console.log(setDoc.id)
                        let date = Dates[i];
                        let newdate = DateTemplate.content.cloneNode(true)
                        newdate.querySelector('.date-goes-here').innerHTML = date
                        newdate.querySelector('.class-goes-here').setAttribute("id", date)
                        document.getElementById('body').appendChild(newdate)
                        set.collection(date).get().then(snap => {
                            snap.forEach(classDoc => {
                                var CourseID = classDoc.data().CourseID
                                console.log(CourseID)
                                var Instructor = classDoc.data().Instructor
                                var Time = classDoc.data().Time

                                let newclass = ClassTemplate.content.cloneNode(true)
                                newclass.querySelector('.card-title').innerHTML = CourseID
                                newclass.querySelector('.instructor').innerHTML = "Instructor: " + Instructor
                                newclass.querySelector('.time').innerHTML = "Time: " + Time
                                newclass.querySelector('.card-body').setAttribute("id", date + CourseID)
                                newclass.querySelector('.viewMore').setAttribute("id", CourseID)
                                document.getElementById(date).appendChild(newclass);

                                
                            })
                        })
                    }
                })

        }
        
        function setLocalStorage(courseName) {
            localStorage.setItem("course" ,courseName)
        }

        insertName();
    </script>
</body>

</html>